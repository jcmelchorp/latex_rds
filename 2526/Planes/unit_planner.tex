\documentclass[12pt]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[spanish]{babel}
\usepackage[most]{tcolorbox}
\tcbuselibrary{skins,raster,breakable} % Load the breakable library
\usepackage{amssymb}
\usepackage{tabularx}
\usepackage[margin=0.5in]{geometry}
\usepackage{ragged2e}
\usepackage{multicol,multirow}
\usepackage{jsonparse} % Load the json package
\usepackage{anyfontsize}
\usepackage{adjustbox}
\usepackage{graphicx} % for \scalebox
\usepackage{xcolor} % For defining colors
\usepackage{colortbl} % For coloring table elements
\usepackage{ifthen}
\usepackage{xifthen}
\usepackage{enumitem} % for custom \item
\usepackage{pgffor}
\usepackage{tikz}
\usetikzlibrary{shapes, positioning,shadows,calendar,decorations.markings}
\usetikzlibrary{shadows.blur}
\usetikzlibrary{shapes.symbols}
\usepackage{xparse} %for NewDocumentCommand
\usepackage{etoolbox}
\usepackage{l3sys-query} %for query JSON files
\usepackage{lipsum}

\pagestyle{empty}
\newcolumntype{Y}{>{\RaggedLeft\arraybackslash}X}
\renewcommand{\arraystretch}{1.2}

\arrayrulecolor{rdsColor}
\setlength{\columnsep}{10pt}
\setlength{\arrayrulewidth}{0.1pt}
\renewcommand\fbox{\fcolorbox{white}{rdsColor!5!white}}


%%% DEFINITIONS
\definecolor{rdsColor}{HTML}{0060A0} % Custom colour
\definecolor{mathColor}{HTML}{E3A857}
\definecolor{physColor}{HTML}{228B22}
\definecolor{chemColor}{HTML}{228B22}
\definecolor{sec1Color}{HTML}{86608E}
\definecolor{sec2Color}{HTML}{4C8BA7}
\definecolor{sec3Color}{HTML}{A94939}

\tcbset{
    unitbox/.style={
        colbacktitle=white,
        colback=rdsColor!0.5!white,
        % colframe=rdsColor,
        colframe=white,
        coltitle=black,
        boxrule=0.4pt,
        boxsep=0pt,
        left=10pt,
        right=10pt,
        top=10pt,
        bottom=10pt,
        subtitle style={
            fontupper=\sffamily,
            boxrule=0.2pt,
            boxsep=2mm,
            top=0mm,
            bottom=0mm,
            colback=rdsColor!10,
            colupper=green!30!black,
        }
    },
    semanabox/.style={
        coltitle=green!30!black,
        colframe=rdsColor,
        colback=rdsColor!1!white,
        colbacktitle=rdsColor!10,
        boxrule=0.1pt,
        frame style={rdsColor},
        top=0pt,
        bottom=0pt,
        left=-7pt,
        right=0pt
    }
}
\newcommand*\circled[1]{\tikz[baseline=(char.base)]{
            \node[shape=circle,draw,inner sep=0.5pt,fill=white,circular glow={fill=rdsColor!40!white},thin] (char) {#1};}}

\def\LOGO{%
    \begin{picture}(0,0)\unitlength=2cm
        \put (0.05,-0.45) {\includegraphics[width=1.6cm]{logo_shadow.png}}
        \put (0.045,-0.44) {\includegraphics[width=1.6cm]{logo.png}}
    \end{picture}
}
\def\itembox{%
    \tcbox[enhanced,drop fuzzy shadow=black,size=fbox,on line,colback=orange!10!white]{\JSONParseArrayValue}
}
\def\itemitemize{%
    \item \JSONParseArrayValue
}
\def\fboxitemize{%
    \item \JSONParseArrayValue \dotfill \fbox{\phantom{/00/}}
}
\def\rowitemtable{%
$\square$ & \JSONParseArrayValue  \\
}
% \newtcolorbox{activitybox}[2][]{%
%   attach boxed title to top center = {yshift=-\tcboxedtitleheight/2},
%   top=5pt,
%   bottom=3pt,
%   left=3pt,
%   right=3pt,
%   colback      = white,
%   colframe     = rdsColor,
%   fonttitle    = \sffamily,
%   colbacktitle = rdsColor!45!white,
%   boxrule=0.4pt,
%   halign=center,
%   boxsep=0mm,
%   title        = \large\textbf{#2},#1,
%   on line,
%   enhanced,
% }

\newtcolorbox{subsectionbox}[1][]{%
    size=fbox,
    top=0pt,%boxsep=2mm,
    bottom=0pt,
    width=\linewidth/8,
    grow to left by=7mm,
    colback = rdsColor!45!white,
    colframe     = rdsColor,
    leftrule=2mm, 
    drop fuzzy shadow=black,
    fontupper=\color{white}\bfseries\sffamily\RaggedLeft,
    #1,
    on line,
    enhanced,
}

% Comando para mostrar el string asociado y su estilo
\newcommand{\classtitle}[1]{%
  \ifthenelse{\equal{#1}{math1}}{\textcolor{mathColor}{\textbf{Matemáticas 1}}}{}%
  \ifthenelse{\equal{#1}{math2}}{\textcolor{mathColor}{\textbf{Matemáticas 2}}}{}%
  \ifthenelse{\equal{#1}{math3}}{\textcolor{mathColor}{\textbf{Matemáticas 3}}}{}%
  \ifthenelse{\equal{#1}{chem3}}{\textcolor{chemColor}{\textbf{Química}}}{}%
  \ifthenelse{\equal{#1}{phys2}}{\textcolor{physColor}{\textbf{Física}}}{}%
  \ifthenelse{\equal{#1}{test0}}{\textcolor{red}{\textbf{TESTING}}}{}%
}

\newcommand{\leveltitle}[1]{%
  \ifthenelse{\equal{#1}{0}}{\textcolor{red}{\textbf{TESTING}}}{}%
  \ifthenelse{\equal{#1}{1}}{\textcolor{sec1Color}{\textbf{1° de Secundaria}}}{}%
  \ifthenelse{\equal{#1}{2}}{\textcolor{sec2Color}{\textbf{2° de Secundaria}}}{}%
  \ifthenelse{\equal{#1}{3}}{\textcolor{sec3Color}{\textbf{3° de Secundaria}}}{}%
}

\newcommand{\plannerof}[3]{%
    \def\disciplina{\classtitle{#2#1}}
    \def\gradogrupo{\leveltitle{#1}}
    \def\schoolinfounit{\RaggedRight%
        {\color{rdsColor}\Large Escuela Rafael Díaz Serdán}\\[-0.5em]
        {\color{gray!40!black}\scriptsize\sffamily 30PES0329R \hspace{10em} turno matutino  }\\
        {\color{green!20!black}\large\sffamily Autocontrol del alumno}\\
        {\sffamily Profesor:} Julio César Melchor Pinto
        %Saberes y pensamiento científico
    }
    \def\unitinfo{%
        \tcbox[colback=rdsColor!5!white,colframe=rdsColor,size=fbox,on line]{ {\sffamily Unidad} #3}
    }
    \def\cicloescolar{%
        \tcbox[colback=red!10!white,colframe=rdsColor,size=fbox,on line]{2025-2026}
    }
    \JSONParseFromFile{\weekdata}{#2#1_u#3.json}
    %\QueryFiles[reverse]{*.json}{\JSONParseFromFile{\weekdata}{##1}}
}

\newcommand{\semanafecha}[1]{
    \begin{tikzpicture}[baseline]
        \node (box) [rdsColor,
            draw,                   % Dibuja el borde
            fill=white,
            anchor=base,overlay,
            rounded corners=2pt,    % Redondea las esquinas
            minimum width=3cm,      % Ancho total
            minimum height=1.4em,    % Alto total
            yshift=0.5em,
            blur shadow={
                shadow opacity=50,
                shadow blur steps=5,
                shadow blur extra rounding=5pt
            },
        ] {}; % El nodo no lleva texto dentro, solo define la forma.
        \draw[rdsColor] ([xshift=-1mm]box.north) -- ([xshift=1mm]box.center) -- ([xshift=-1mm]box.south);
        \node[black] at ([xshift=-0.8cm]box.center) {\JSONParseValue{\weekdata}{weeks[#1].FechaDeInicio}};
        \node[black] at ([xshift=0.8cm]box.center) {\JSONParseValue{\weekdata}{weeks[#1].FechaDeCierre}};
    \end{tikzpicture}%
}


\newcommand{\arrayitemtable}[2]{%
\JSONParseArrayMapFunction[
    code before={\begin{tabularx}{\linewidth}{rl}},
    code after={\end{tabularx}}
]{\weekdata}{weeks[#1].#2}{\rowitemtable}
}

% \newcommand{\periodoslectivos}[1]{%
%     \tcbox[colframe=rdsColor,size=fbox,on line]{%
%         {\large\JSONParseValue{\weekdata}{weeks[#1].PeriodosLectivos}}\ %
%         \begin{minipage}[b]{0.8cm}\sffamily\tiny Períodos\\lectivos\end{minipage}%
%     }%
% }
\newcommand{\periodoslectivos}[1]{%
   \tcbox[,on line,size=fbox,arc=1.5pt,colback=yellow!20!white,colframe=rdsColor!50,sharp corners=southeast]{%
        {#1}\ %
        \begin{minipage}[b]{0.8cm}\color{black!75}\sffamily\tiny Períodos\\[-0.2em] lectivos \end{minipage}%
    }%
}
% \newtcbox{\headerbox}{}
\newcommand{\tableta}[1]{%
\JSONParseArrayMapFunction[%
    code before={%
    \begin{tcolorbox}[
        before app={},
        after app={},
        enhanced,
        drop fuzzy shadow=black!75,
        tabulars={@{\extracolsep{\fill}\hspace{1mm}}lr@{\hspace{2pt}}},
        arc=2pt,boxrule=0.1pt,left=0mm,right=0mm,top=0mm,bottom=2pt,
        coltitle=rdsColor!30!black,
        colbacktitle=rdsColor!10!white,
        colback=white,
        colframe=rdsColor,
        toptitle=0mm,
        bottomtitle=0mm,
        lefttitle=1mm,
        width=0.8\linewidth,
        title={\coolTitle{#1}}]%
        {\footnotesize\sffamily\qquad Actividad} & {\footnotesize\sffamily Fecha \ \! C  \! \ L \! \ O \! Pr \! Pu Tot.} \\\hline\hline%
        },
    code after={\end{tcolorbox}}
]{\weekdata}{weeks[#1].Worklist}{\listableta}
}

\def\fillingradebox{\raisebox{-0.35em}{\LARGE$\Box$}}

\def\listableta{%
\adjustbox{max width=0.58\linewidth}{\JSONParseArrayValue} & {\fbox{\phantom{oooo}} \color{gray}\fillingradebox\fillingradebox\fillingradebox\fillingradebox\fillingradebox{\color{rdsColor}\fillingradebox}}\\ \hline
}

\newcommand{\coolTitle}[1]{% %
{\small\circled{\JSONParseValue{\weekdata}{weeks[#1].SemanaEscolar}}} \JSONParseValue{\weekdata}{weeks[#1].Tema} \hfill
\tcbox[on line,size=fbox,arc=1.5pt,colback=orange!10!white,colframe=rdsColor!50,sharp corners=southwest]{\large\JSONParseValue{\weekdata}{weeks[#1].FechaDeInicio} \textbf{<} \JSONParseValue{\weekdata}{weeks[#1].FechaDeCierre}}
\periodoslectivos{\JSONParseValue{\weekdata}{weeks[#1].PeriodosLectivos}}%
}



% Comando para el diseño del encabezado
\def\unitboxtitle{%
    \begin{minipage}{0.1\textwidth}
        \LOGO
    \end{minipage}%
    \begin{minipage}{0.38\textwidth}
        \schoolinfounit
    \end{minipage}%
    \begin{tabularx}{0.52\textwidth}{rYr}%
          & \large\disciplina &  \large\unitinfo  \\ 
          & \large\gradogrupo &  \large\cicloescolar \\ 
         \cline{2-3}
         {\large\sffamily Alumno:} &  \multicolumn{2}{|r|}{}\\
         \cline{2-3}
    \end{tabularx}
}



\newcommand{\calrow}[1]{\node[anchor=base east](lun){L};
\node[base right=of lun](mar){M}; \node[base right=of mar](mer){X};
\node[base right=of mer](jue){J}; \node[base right=of jue](vie){V};
\node[base right=of vie](sab){S}; \node[base right=of sab](dom){D};
\node[rdsColor,above=of jue]{#1};}
 
\newcommand{\calperiod}[2]{\calendar[dates=#1 to #2]
if(weekend) [black!30] \holidays;%
}
\def\currentyear{2025}
\def\nextyear{2026}



\newcommand{\holidays}{% holidays in Italy
if (equals=09-16) [red!100]%
if (equals=09-26) [green!50!black]%
if (equals=10-31) [green!50!black]%
% if (between=\year-11-17 and \year-11-last) [black!30];
if (between=\year-11-01 and \year-11-16) [black!30];
if (between=\nextyear-03-24 and \nextyear-03-last) [black!30];

}
 


\begin{document}
%%  \planner{grado}{materia}{unidad}
\plannerof{0}{test}{1}%%
%  \plannerof{1}{math}{1}%
%   \plannerof{2}{math}{1}%
%   \plannerof{3}{math}{1}%
%   \plannerof{3}{chem}{1}%   
%   \plannerof{2}{phys}{1}%
\begin{tcolorbox}[unitbox,title=\unitboxtitle,breakable,halign=center]
	\adjustbox{max width=\textwidth}{%
    \begin{tikzpicture}[every calendar/.style={week list},
			year label/.style={
					fill=white,text=rdsColor,font=\bfseries\large
				}, current year/.store in=\currentyear,
			current year=2025]
		\matrix[%
			row 1/.style={rdsColor,node distance=.3ex},%
			row 3/.style={rdsColor,node distance=.3ex},
			column sep=1ex,%
			draw=rdsColor,thick,rounded corners=1pt,%
			append after command={
					\pgfextra{\edef\matrixname{\tikzlastnode}}
					node [year label/.try, right=1ex of \matrixname.north west] {\currentyear}
					node [year label/.try, left=1ex of \matrixname.north east] {\nextyear}
				}
		]{%
			% first row: week day and month
			\calrow{Noviembre} & \calrow{Diciembre} & \calrow{Enero} & \calrow{Febrero} & \calrow{Marzo}  \\
			% second row: calendar
			 \calperiod{2025-11-17}{2025-11-30} & \calperiod{2025-12-01}{2025-12-21}   & \calperiod{2026-01-01}{2026-01-21} & \calperiod{2026-02-01}{2026-02-28} & \calperiod{2026-03-01}{2026-03-23}  \\
			 \calperiod{2025-11-31} & \calperiod{2025-02-01}{2025-02-28} & \calperiod{2025-03-01}{2025-03-23}  \\
		};
	\end{tikzpicture}%
    }
	% \JSONParseArrayMapInline{\weekdata}{weeks}{\tableta{#1}}
\end{tcolorbox}
\end{document}